<!DOCTYPE html>
<html style="font-family: 'Trebuchet MS', Helvetica, sans-serif; margin: 0px; height:100%; background: linear-gradient(-45deg, #ee7752, #e73c7e, #23a6d5, #23d5ab);">
<head>
  <title>Treasurement 2023</title>
  <link rel="icon" type="image/ico" href="favicon.ico">
  <link rel="stylesheet" href="style.css">
</head>
  
<body style="margin: 0px; padding: 5svh 10vw 5svh 10vw;">
    <div style="padding: 0 5% 5% 5%; border: 2px solid rgb(17, 17, 17); background-color: #f4f4f4; border-radius: 10px; box-shadow: 0px 22px 26px rgba(241, 234, 103, 0.1);">
      <h1 style="font-weight: bold;">Treasurement</h1>
      <h2 style="font-weight: bold;">Leo's 2023 Easter Treasure Hunt</h2>
      <h5><i>The first response typically takes 30s to appear, but after that runs relatively quickly. User chat history is stored temporarily in Pipedrive.</i></h4>
      <div id="chat" style="width:100%; height: 300px; padding-right: 20px; overflow-y: scroll;">
      </div>
      <form style="margin-top: 10px; display: flex; ">
        <div style="flex-grow: 0.91;background-color: #f8f8f8; border-radius: 12px; box-shadow: 0px 5px 10px rgb(213, 213, 213); padding: 10px;">
          <div style="display: flex; justify-content: space-between;">
            <input type="text" id="userInput" placeholder="Type your message here..." style="border: 2px solid rgb(227, 227, 227) !important; width: 75%; border-radius: 10px; font-size:15px; border: none; padding: 15px; font-family: 'Roboto', sans-serif; color: #333;">
            <button type="submit" class="hover" style="width: auto; border: 2px solid rgb(227, 227, 227); border-radius: 10px; padding: 15px; border: none; color: white; font-size:16px; background-color: #11bc94; font-family: 'Roboto', sans-serif; text-align:center; cursor: pointer;">Send</button>
          </div>
        </div> 
      </form>
    </div>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.min.js" async></script>
  <script>
    const chatbox = document.getElementById('chat');
    const userInput = document.getElementById('userInput');
    const form = document.querySelector('form');        
    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      var content = userInput.value;
      var role = "user"
      const chatMessage = document.createElement('p');
      chatMessage.classList.add('user-style', 'messages');
      chatMessage.innerText = content;
      chatbox.appendChild(chatMessage);
      
      if (content.includes("fjekvhdsngmbqaip")) {
        var content = "We have discovered all 16 clues and have uncovered the prize! The treasure is in the attic! We are going there now. Thank you for hosting our game!";        
        const response = await fetch('https://eog9m1u341lz6lp.m.pipedream.net', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({role, content}),
        });
        var botText = "Congratulations, you have deciphered the secret code! The treasure is in the attic. Enjoy your prize!"
        
        var role = "assistant"
        var content = "Congratulations for completing the puzzle! The scavanger hunt is over now. I hope you enjoyed playing. There are no more clues to seek, and I am no longer your host.";
        const response2 = await fetch('https://eog9m1u341lz6lp.m.pipedream.net', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({role, content}),
        });
      }
      else {
      const response = await fetch('https://eo1kzmelohbf68b.m.pipedream.net', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({role, content}),
      });
      var botText = await response.text();
      }
      console.log(botText)

      const botMessage = document.createElement('p');
      botMessage.classList.add('host-style', 'messages');
      botMessage.innerText = botText;
      chatbox.appendChild(botMessage);
      chatbox.scrollTop = chatbox.scrollHeight+200;
      userInput.value = '';
    });
  </script>
</body>
</html>
