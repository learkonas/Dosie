<!DOCTYPE html>
<html>
<head>
  <title>Dosie</title>
  <link rel="stylesheet" type="text/css" href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css" />
</head>
  
<body style="background: linear-gradient(-45deg,#ee7752,#e73c7e,#23a6d5,#23d5ab);">
  <div class="container" style="margin: 25px; margin-left: 100px">
    <div class="jumbotron">
      <h1>Hello, world, this is a test!</h1>
      <p>christ that took <a href="https://github.com/learkonas/dosie/commits/master" role="button" target="_blank">a while</a></p>
      <p><a class="btn btn-primary btn-lg" href="https://easter.leonasskau.com" role="button" target="_blank">Easter</a></p>
    </div>
    <div class="jumbotron">
      <div class="container">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css">
        <div class="row" style="width: 1000px; margin: auto; border-width: 5px;" >
          <div class="col-md-6 offset-md-3">
            <h3 class="text-center my-5">Treasurement</h3>
            <div id="chat" class="border p-2" style="height: 300px; overflow-y: scroll;">
              <p class="text-center">Leo's 2023 Easter Hunt</p>
            </div>
            <form class="mt-3">
              <div class="row">
                <div class="col-md-10">
                <input type="text" id="userInput" class="form-control" placeholder="Type your message here...">
                </div>
                <div class="col-md-2">
                  <button type="submit" class="btn btn-primary">Send</button>
                </div>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>
  </div>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.min.js"></script>
  <script>
    const chatbox = document.getElementById('chat');
    const userInput = document.getElementById('userInput');
    const form = document.querySelector('form');        
    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      const userMessage = userInput.value;
      const chatMessage = document.createElement('p');
      chatMessage.classList.add('bg-secondary', 'text-white', 'p-2', 'my-3', 'rounded');
      chatMessage.innerText = `You: ${userMessage}`;
      chatbox.appendChild(chatMessage);
      
      //async function sendMessage(text) {}
      const response = await fetch('/message', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ userMessage }),
      });
      //const { botMessage: botText } = await response.json();
      const botText = `This is the bot's response to "${userMessage}"`; // Feed user input into JS script and get the response here
      

      const botMessage = document.createElement('p');
      botMessage.classList.add('bg-primary', 'text-white', 'p-2', 'my-3', 'rounded');
      botMessage.innerText = `Bot: ${botText}`;
      chatbox.appendChild(botMessage);
      chatbox.scrollTop = chatbox.scrollHeight;

      userInput.value = '';
    });
  </script>
  <!script>
  const chatboxx = document.getElementById('chat');
  const formx = document.querySelector('form');
  const input = document.getElementById('userInput');

  formx.addEventListener('submit', (event) => {
    event.preventDefault();
    const text = input.value;
    if (text.trim()) {
      const message = document.createElement('div');
      message.className = 'message message-user';
      message.innerHTML = text;
      console.log("in formx test trim")
      chatboxx.appendChild(message);
      input.value = '';
      sendMessage(text);
    }
  });

  async function sendMessage(text) {
    const response = await fetch('/chat', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({ text })
    });
    console.log("sent /chat request")
    const message = await response.json();
    const reply = message.message;
    const botMessage = document.createElement('div');
    botMessage.className = 'message message-bot';
    botMessage.innerHTML = reply;
    chatboxx.appendChild(botMessage);
  }
  </script>
</body>
</html>
